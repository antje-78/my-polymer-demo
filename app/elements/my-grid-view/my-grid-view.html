<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">

<dom-module id="my-grid-view">
  <template>
    <style is="custom-style" include="shared-style">
    </style>
    <iron-media-query full query="print" query-matches="{{print}}"></iron-media-query>
    <my-json-request url$="{{serviceUrl}}/time-sheet/time-sheet-columns" result="{{columns}}"></my-json-request>

    <div class="">
      <!--<content selector=".filterContainer"></content>-->
      <div class="filterContainer">
        <p>Filter</p>
        <my-filter url="{{serviceUrl}}" filters="{{filters}}" date-from="{{dateNow}}" date-to="{{dateNow}}"></my-filter>
      </div>
    </div>

    <iron-icon id="refreshBtn" icon="refresh" on-tap="_refreshGrid"></iron-icon>

    <my-remote-grid-data url$="[[serviceUrl]]/time-sheet/time-sheet-data" items="{{items}}" filters="{{filters}}"></my-remote-grid-data>
    <p></p>
    <my-grid items="{{items}}" columns="{{columns}}">
    </my-grid>
  </template>
  <script>
    Polymer({
      is: 'my-grid-view',

      properties: {
        items: Array,

        baseUrl: String,

        serviceUrl: String,

//        filters: {
//          type: Object,
//          notify: true
//        },

        columns: {
          type: Array,
          notify: true
        },

        iconRotate: {
          type: Number,
          value: 0
        },

//        columns: {
//          type: Array,
//          value: [{name: 'firstName', title: 'Vorname'}, {name: 'lastName', title: 'Nachname'}, {name: 'street', title: 'Stra√üe'}, {name: 'city', title: 'Stadt'}, {name: 'state', title: 'Bundesland'}, {name: 'zipcode', title: 'PLZ'}, {name: 'country', title: 'Land'}, {name: 'phone', title: 'Telefonnummer'}, {name: 'email', title: 'E-Mail'}],
//          notify: true
//        }
      },

      listeners: {
        'start-rotate-refresh-icon': '_startRotateRefreshIcon',
        'filters-changed': '_filtersChanged'
      },

      _refreshGrid: function () {
        this.fire('refresh', this.querySelector('my-filter').get('filters'), { node: this.querySelector("my-remote-grid-data"), bubbles: true, cancelable: false });

        this.fire('start-rotate-refresh-icon', {}, { bubbles: true, cancelable: true});
      },

      _startRotateRefreshIcon: function () {
        this.iconRotate = this.iconRotate + 15;
        this.transform('rotateZ(' + this.iconRotate  + 'deg)', this.$.refreshBtn);
//        this.fire('start-rotate-refresh-icon', {}, { bubbles: true, cancelable: true});
      },

      _filtersChanged: function () {
        console.log(this.localName + ' _filtersChanged fired', this.filters);
      }
    })
  </script>
</dom-module>
