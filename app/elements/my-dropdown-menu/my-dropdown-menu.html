<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-badge/paper-badge.html">

<dom-module id="my-dropdown-menu">
  <template>
    <style is="custom-style" include="shared-styles">
      :root {
        --paper-badge: {
          margin-top: 40px;
        }
      }
      paper-item {
        border-bottom: 1px solid var(--divider-color);
      }
      paper-item:focus:before {
        background-color: var(--primary-background-color);
      }
      .iron-selected {
        background-color: var(--divider-color);
      }
      .dropdown-container{
        display: inline-block;
      }
      .dropdown-container > paper-badge {
        --paper-badge-margin-left: -25px;
        --paper-badge-background: var(--divider-color);
      }

    </style>
    <my-json-request url="[[url]]" items="{{items}}" on-response="_response"></my-json-request>
    <div class="dropdown-container">
      <paper-dropdown-menu id="my-dropdown-menu" label="[[label]]" placeholder="[[placeholder]]" always-float-label toggles="true">
        <div class="dropdown-content">
        <iron-selector multi selected-items="{{selectedItems}}" ><!--attr-for-selected="name" -->
            <template is="dom-repeat" items="[[items]]">
              <paper-item name="{{item.id}}">{{item.bezeichnung}}</paper-item>
            </template>
        </iron-selector>
        </div>
      </paper-dropdown-menu>
      <template is="dom-if" if="{{showBadge}}">
        <paper-badge label="{{selectedItems.length}}"></paper-badge>
      </template>
    </div>
  </template>
  <script>
    HTMLImports.whenReady(function () {
      Polymer({
        is: 'my-dropdown-menu',

        properties: {
          label: {
            type: String,
            value: 'Label'
          },

          placeholder: {
            type: String,
            value: 'Bitte auswÃ¤hlen'
          },

          url: String,

          items: {
            type: Array,
            observer: '_itemsChanged'
          },

          selectedItems: {
            notify: true,
            observer: '_selectedItemsChanged'
          },

          showBadge: {
            type: Boolean,
            value: false
          }
        },

        listeners: {
          'response': '_response',
          'iron-select': '_onSelect'
        },

//        observers: [
//          'onAddOrRemoveValue(values.splices)'
//        ],

        created: function () {
          console.log(this.localName + ' was created!');
//          if (typeof this.url != undefined)
//            console.log('url: ' + this.url);
        },

        ready: function () {
          console.log(this.localName + ' was ready!');
//          if ( typeof this.url != undefined)
//            console.log('url: ' + this.url);
        },

        attached: function () {
          console.log(this.localName + ' was attached!');
          console.log(this.result);
//          if ( typeof this.url != undefined)
//            console.log('url: ' + this.url);
        },

        _response: function (e) {
          console.log(this.localName + ' response fired!' + e.detail.response);
          this.result = e.detail.response;
        },

        _selectedItemsChanged: function (newValue) {
          console.log(this.localName + ' _valuesChanged fired!');
          this.showBadge = (this.selectedItems.length > 0) ? true : false;
        },

        _onSelect: function (e) {
          console.log(this.localName + ' _onSelect fired!', e, e.detail);
        },

        _itemsChanged: function (e) {
          console.log(this.localName + ' _itemsChanged fired!', e, e.detail);
        }
      });
    });
  </script>
</dom-module>
