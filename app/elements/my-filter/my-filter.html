<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../../bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">


<dom-module id="my-filter">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-reverse">

      div.layout.vertical {
        margin-right: 10px;
      }
    </style>

    <div class="layout horizontal layout-start">
      <div class="layout vertical layout-start">
        <my-date-picker id="dateFromDatepicker" label="Eventdatum von" placeholder="Datum eingeben" date="{{dateFrom}}"></my-date-picker>
        <my-dropdown-menu id="meeting-points-dropdown" label="Treffpunkt" placeholder="Treffpunkt ausw채hlen" url$="[[url]]/time-sheet/meetingPointList" values="{{meetingPoints}}"></my-dropdown-menu>
      </div>

      <div class="layout vertical layout-start">
        <my-date-picker id="dateToDatepicker" label="Eventdatum bis" placeholder="Datum eingeben" date="{{dateTo}}"></my-date-picker>
        <my-dropdown-menu id="topics-dropdown" label="Thema" placeholder="Thema ausw채hlen" url$="[[url]]/time-sheet/topicList" values="{{topics}}"></my-dropdown-menu>
      </div>
      <div class="layout vertical-reverse layout-start">
        <div class="layout horizontal layout-start">
          <my-dropdown-menu id="event-types-dropdown" label="Eventtyp" placeholder="Eventtyp ausw채hlen" url$="[[url]]/time-sheet/eventTypeList" values="{{eventTyps}}"></my-dropdown-menu>
          <paper-dropdown-menu id="ressources-dropdown" label="Ressourcen" placeholder="Ressourcen ausw채hlen">
            <div class="layout horizontal layout-start dropdown-content">
              <paper-menu class="dropdown-content" multi>
                <paper-item>Ressource 1</paper-item>
              </paper-menu>
              <paper-menu class="dropdown-content" multi>
                <paper-item>Ressource 2</paper-item>
              </paper-menu>
            </div>
          </paper-dropdown-menu>
          <paper-toggle-button name="excludeCanceledEventsToggle" checked="{{filters.excludeCanceledEvents}}">Ausgefallene Events ausblenden</paper-toggle-button>
        </div>
      </div>
    </div>
  </template>
  <script>
    HTMLImports.whenReady(function () {
      Polymer({
        is: 'my-filter',

        properties: {
          filters: {
            type: Object,
            value: { dateFrom: null, dateTo: null, excludeCanceledEvents: false, eventTyps: null, meetingPoints: null, topics: null },
            notify: true
          },

          dateFrom: {
            type: Date,
            observer: 'onDateFromChanged'
          },

          dateTo: {
            type: Object,
            notify: true,
            observer: 'onDateToChanged'
          },

          meetingPoints: {
            type: Array,
            observer: 'onMeetingpointsSelected'
          },

          topics: {
            type: Array,
            observer: 'onTopicsSelected'
          },

          eventTyps: {
            type: Array,
            observer: 'onEventTypesSelected'
          },

          url: String
        },

      onDateFromChanged: function (newValue, oldValue) {
        console.log(this.localName + ' onDateFromChanged fired!');
        this.set('filters.dateFrom', newValue.getTime());
      },

      onDateToChanged: function(newValue, oldValue) {
        console.log(this.localName + ' onDateToChanged fired!');
        this.set('filters.dateTo', newValue.getTime());
      },

      onMeetingpointsSelected: function (newValue, oldValue) {
        console.log(this.localName + ' onMeetingpointsSelected fired!', newValue, oldValue);
        var ids = '';
        for (var i = 0; i < newValue.length; i++)
        {
          ids = ids + ( i > 0 ? ',' : '') + newValue[i].name;
        }
        this.set('filters.meetingPoints', ids);
      },

      onTopicsSelected: function (newValue, oldValue) {
        console.log(this.localName + ' onTopicsSelected fired!', newValue, oldValue);
        var ids = '';
        for (var i = 0; i < newValue.length; i++)
        {
          ids = ids + ( i > 0 ? ',' : '') + newValue[i].name;
        }
        this.set('filters.topics', ids);
      },

      onEventTypesSelected: function (newValue, oldValue) {
        console.log(this.localName + ' onEventTypesSelected fired!', newValue, oldValue);
        var ids = '';
        for (var i = 0; i < newValue.length; i++)
        {
          ids = ids + ( i > 0 ? ',' : '') + newValue[i].name;
        }
        this.set('filters.eventTyps', ids);
      }

    });
  });

  </script>
</dom-module>
