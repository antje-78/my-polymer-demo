<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="my-grid">
  <template>
    <style>
      #loadingIndicatorRow .hide {
        display: none;
      }
      #loadingIndicatorRow .show {
        display: block;
      }

      vaadin-grid {
        -webkit-user-select: initial;
      }

      vaadin-grid /deep/.vaadin-grid-header.vaadin-grid th.vaadin-grid {
        padding-right: 0;
      }

      vaadin-grid /deep/.vaadin-grid-body.vaadin-grid td.vaadin-grid {
        padding-right: 0;
      }

      vaadin-grid /deep/.vaadin-grid-footer.vaadin-grid td.vaadin-grid {
        padding-right: 0;
      }

      vaadin-grid table:before {
        -webkit-animation: vaadin-grid-spin-360 400ms linear infinite;
        animation: vaadin-grid-spin-360 400ms linear infinite;
        border: 2px solid #03A9F4;
        border-radius: 50%;
        border-right-color: transparent;
        border-top-color: transparent;
        content: "";
        display: block;
        height: 16px;
        left: 50%;
        margin-left: -8px;
        margin-top: -8px;
        position: absolute;
        top: 60%;
        width: 16px;
        z-index: 9;
      }
      /* Anim */
      @keyframes grid-spin-360 {
        100% {
          transform: rotate(360deg);
        }
      }

      @-webkit-keyframes grid-spin-360 {
        100% {
          -webkit-transform: rotate(360deg);
          transform: rotate(360deg);
        }
      }

      #grid-container.grid-loading-data vaadin-grid:after {
        -webkit-animation: grid-spin-360 400ms linear infinite;
        animation: grid-spin-360 400ms linear infinite;
        border: 2px solid #03A9F4;
        border-radius: 50%;
        border-right-color: transparent;
        border-top-color: transparent;
        content: "";
        display: block;
        height: 16px;
        left: 50%;
        margin-left: -8px;
        margin-top: -8px;
        position: absolute;
        top: 70%;
        width: 16px;
        z-index: 9;
      }
    </style>
    <div id="grid-container">
      <my-remote-grid-data url="[[url]]" items="{{items}}"></my-remote-grid-data>

      <vaadin-grid id="grid" items="{{items}}" selection-mode="disabled">
      </vaadin-grid>
    </div>
  </template>
  <script>
    (function() {
      var MyGrid = Polymer({
        is: 'my-grid',

        properties: {
          items: {
            type: Array,
            notify: true
          },

          url: String,

          columns: {
            type: Array,
            notify: true
          }
        },

        listeners: {
          'refresh': '_refreshGrid',
          'columns-changed': '_columnsChanged',
          'items-changed': '_itemsChanged'
        },

        created: function (e) {
          console.log(this.localName + ' was created!')
        },

        ready: function (e) {
          console.log(this.localName + ' was ready!');
        },

        attached: function () {
          console.log(this.localName + ' was attached!');
        },

        detached: function () {

        },

        _columnsChanged: function () {
          console.log(this.localName + ' columnsChanged fired!');
          var vaadin_grid = this.querySelector('vaadin-grid');
          for(var i = 0; i < this.columns.length; i++)
          {
            vaadin_grid.columns[i] = { "name": this.columns[i].propertyName, "hidable": this.columns[i].hidable, "hidden": this.columns[i].hidden, "sortable": this.columns[i].sortable };
          }

          vaadin_grid.then(function () {
            var vaadin_grid = document.querySelector("vaadin-grid");
            var grid = document.querySelector("my-grid");
            if (vaadin_grid == undefined || grid == undefined || grid == null || grid.columns == null)
              return;
            for(var i = 0; i < grid.columns.length; i++) {
              console.log('Header-Cell 0,'+ i + ': ' , vaadin_grid.header.getCell(0, i));
              vaadin_grid.header.getCell(0, i).content = grid.columns[i].name;
            }
          });
        },

        _itemsChanged: function () {
          grid.toggleClass('grid-loading-data', false, document.querySelector("#grid-container"));
        },

        _refreshGrid: function(){
          console.log(this.localName + ' refresh!');
          var grid = document.querySelector("vaadin-grid");
          if (grid == undefined)
            return;
          this.toggleClass('grid-loading-data', true, document.querySelector("#grid-container"));
          grid.items = [{}];
//          this.fire('loadData-' + this.getAttribute('id'), { 'grid' : grid });
        },

        _dataLoaded: function() {
          grid.items = this.items == undefined ? [] : this.items;
        },

        updateItems: function () {
          var grid = document.querySelector("vaadin-grid");
          grid.items = [{}];

//          var loadingIndicatorRow = document.getElementById('loadingIndicatorRow');
//          loadingIndicatorRow.setAttribute("class", "show");
//                      grid.items = function(params, callback) {
//                        getJSON('https://demo.vaadin.com/demo-data/1.0/people?index=' + params.index + '&count=' + params.count, function(json) {
//                          callback(json.result, json.size);
//                        });
//                      };
        }
      });
    })();
  </script>
</dom-module>
